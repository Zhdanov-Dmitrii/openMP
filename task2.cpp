#include <iomanip>
#include <iostream>
#include <vector>
#include <omp.h>

using namespace std;

double run(const vector<int> &vec1, const vector<int> &vec2, int threads, int size) {
    double time = omp_get_wtime();
    int res = 0;
    omp_set_num_threads(threads);
#pragma omp parallel for default(shared) reduction(+:res)
    for (int i = 0; i < size; ++i)
        res += vec1[i]*vec2[i];

    return omp_get_wtime() - time;
}

int main(int argc, char **argv) {
    int threads_max = omp_get_max_threads();
    vector times(threads_max, vector(100, 0.));

    auto vector_generator = [](int size) {
        vector data(1'000'000'000, 0);
        for (auto &i: data)
            i = rand() % 10'000;
        return move(data);
    };

    int iter_count = 10;
    int size_max = 100'000'000;
    int step = 1'000'000;

    for (int i = 0; i < iter_count; ++i) {
        cout << "iter " << i +1 << "/" << iter_count << endl;
        auto vec1 = vector_generator(size_max);
        auto vec2 = vector_generator(size_max);
        for (int size = step; size <= size_max; size += step) {
            cout << "\tsize " << size << "/" << size_max << endl;
            for (int threads = 1; threads <= threads_max; ++threads) {
                cout << "\t\tthreads " << threads << "/" << threads_max << endl;
                times[threads-1][size/step-1] += run(vec1, vec2, threads, size);
            }
        }
    }

    cout << endl;
    std::cout << std::fixed;
    std::cout << std::setprecision(6);
    for (const auto& thread : times) {
        for (const auto time : thread) {
            cout << time / iter_count << " ";
        }
        cout << endl;
    }
    return 0;
}

/*
0.035134 0.046222 0.053756 0.043046 0.056199 0.035246 0.038320 0.054872 0.055572 0.055453 0.057325 0.052151 0.049279 0.064929 0.041392 0.047788 0.047602 0.044185 0.053115 0.057140 0.049600 0.063052 0.058580 0.055355 0.044756 0.050720 0.055418 0.050140 0.043596 0.057315 0.050604 0.049836 0.042029 0.050195 0.054535 0.044638 0.059574 0.048358 0.047345 0.041932 0.052018 0.066476 0.054279 0.067075 0.064481 0.059477 0.073174 0.061814 0.065653 0.057219 0.073766 0.064220 0.079228 0.068185 0.055620 0.057638 0.068891 0.069511 0.072438 0.068979 0.073358 0.055762 0.068185 0.073946 0.062767 0.058781 0.066639 0.063211 0.061694 0.060809 0.060442 0.061159 0.072556 0.070025 0.061890 0.086613 0.070939 0.071401 0.082954 0.072483 0.072978 0.067699 0.072352 0.073830 0.072589 0.076256 0.083423 0.068495 0.078878 0.075351 0.071742 0.067747 0.074360 0.068132 0.077800 0.082021 0.081421 0.092736 0.089893 0.077853
0.001835 0.000847 0.001320 0.001643 0.002129 0.002380 0.002936 0.003132 0.003853 0.004199 0.004688 0.005048 0.005339 0.006242 0.006239 0.006643 0.006850 0.007203 0.008027 0.008221 0.008801 0.009161 0.009702 0.010259 0.009663 0.010983 0.010965 0.011391 0.010993 0.012377 0.011501 0.013181 0.011579 0.013668 0.013718 0.013733 0.014722 0.014769 0.013929 0.014271 0.015915 0.016699 0.016978 0.015925 0.015877 0.017612 0.017007 0.017812 0.018860 0.017949 0.019166 0.019433 0.020355 0.020096 0.018791 0.020107 0.020463 0.019945 0.021835 0.021457 0.020868 0.020013 0.021742 0.023059 0.023868 0.022761 0.025643 0.025029 0.027395 0.027438 0.026675 0.029699 0.028891 0.028985 0.030305 0.028457 0.032044 0.030737 0.028930 0.030495 0.029677 0.031447 0.031192 0.031870 0.032443 0.030586 0.028828 0.032083 0.030292 0.030962 0.030350 0.031592 0.031551 0.032629 0.033271 0.032267 0.035545 0.034726 0.033991 0.033082
0.001122 0.000785 0.001202 0.001447 0.001943 0.002238 0.002717 0.002993 0.003678 0.003879 0.004381 0.004488 0.005201 0.005740 0.005490 0.005842 0.006189 0.006135 0.007125 0.007371 0.007582 0.007945 0.007910 0.008538 0.008420 0.009206 0.009424 0.009870 0.009811 0.010469 0.009903 0.011050 0.010114 0.011809 0.011454 0.012303 0.013075 0.013041 0.013009 0.012978 0.014177 0.014577 0.014973 0.013907 0.014260 0.014983 0.014823 0.015307 0.016257 0.015477 0.016420 0.016215 0.017722 0.017937 0.017257 0.017350 0.017729 0.018113 0.019043 0.019633 0.019019 0.018914 0.019352 0.020721 0.021849 0.021421 0.023365 0.024035 0.024333 0.024791 0.024998 0.025554 0.024413 0.024136 0.026579 0.024926 0.027693 0.024558 0.025467 0.024979 0.024983 0.026314 0.026002 0.024937 0.026147 0.025422 0.024566 0.027200 0.026174 0.027361 0.029457 0.026576 0.030911 0.028850 0.028581 0.029216 0.031677 0.030753 0.030775 0.030696
0.000382 0.000764 0.001188 0.001519 0.001856 0.002311 0.002686 0.002965 0.003541 0.003607 0.004216 0.004350 0.004886 0.005226 0.005408 0.005549 0.005905 0.005842 0.006580 0.007145 0.007376 0.007360 0.007899 0.008159 0.008404 0.008657 0.009203 0.009341 0.009581 0.010312 0.010017 0.011588 0.010507 0.011639 0.011570 0.012340 0.012412 0.012763 0.013005 0.013000 0.014266 0.014329 0.014224 0.013854 0.013993 0.014903 0.015067 0.015463 0.016215 0.015934 0.015616 0.016472 0.017452 0.018353 0.018081 0.018105 0.017995 0.018103 0.019442 0.019820 0.020027 0.019640 0.020541 0.021912 0.022675 0.021825 0.024353 0.023760 0.023164 0.023407 0.024701 0.023536 0.022903 0.023831 0.025283 0.024287 0.024635 0.023818 0.023074 0.023726 0.024877 0.024746 0.024998 0.025032 0.026140 0.026072 0.025390 0.028343 0.026266 0.028818 0.029562 0.026942 0.030734 0.029995 0.028723 0.029496 0.032276 0.029378 0.030284 0.032025
0.000400 0.000766 0.001171 0.001589 0.001927 0.002391 0.002733 0.002991 0.003561 0.003861 0.004090 0.004313 0.004822 0.005094 0.005692 0.005900 0.005937 0.005976 0.006801 0.007391 0.007860 0.007959 0.008195 0.008511 0.009107 0.009082 0.009660 0.009785 0.009765 0.010456 0.010677 0.011844 0.010981 0.012040 0.011991 0.013136 0.013050 0.013071 0.013740 0.013885 0.014192 0.014358 0.014732 0.014382 0.014660 0.015857 0.015432 0.016244 0.016596 0.016601 0.016530 0.018075 0.017635 0.019235 0.018996 0.019302 0.018914 0.018736 0.020660 0.020424 0.020841 0.021499 0.021054 0.022419 0.023273 0.022766 0.022910 0.022928 0.022816 0.023406 0.023581 0.023460 0.023281 0.023617 0.025296 0.024986 0.024714 0.025540 0.024410 0.025973 0.026306 0.026492 0.026041 0.026241 0.027051 0.026977 0.027590 0.029270 0.027989 0.030212 0.028992 0.030456 0.030738 0.030950 0.029910 0.033500 0.031888 0.031273 0.032523 0.031965
0.000652 0.000791 0.001249 0.001704 0.001894 0.002486 0.002759 0.003187 0.003580 0.004002 0.004167 0.004448 0.005013 0.005130 0.005673 0.005925 0.006185 0.006194 0.006877 0.007126 0.007862 0.008649 0.008835 0.008518 0.008873 0.009045 0.010110 0.009852 0.010233 0.010976 0.010381 0.011722 0.011061 0.012478 0.012109 0.012666 0.013179 0.013120 0.014263 0.013802 0.014197 0.014640 0.014960 0.015126 0.015827 0.015989 0.016133 0.016516 0.017052 0.017169 0.017285 0.017956 0.018180 0.019121 0.019676 0.020293 0.019783 0.019573 0.021375 0.021199 0.021666 0.022216 0.022317 0.022910 0.023318 0.023083 0.022609 0.023427 0.022543 0.023332 0.023312 0.024254 0.023128 0.023960 0.025012 0.023954 0.024745 0.025125 0.025226 0.026227 0.026843 0.026134 0.026552 0.027017 0.027319 0.027079 0.028296 0.027665 0.028197 0.030696 0.029561 0.031690 0.030951 0.031019 0.032441 0.033711 0.033127 0.033179 0.033825 0.032479
0.000422 0.000964 0.001418 0.001805 0.002003 0.002741 0.002801 0.003315 0.003699 0.004044 0.004502 0.004709 0.005046 0.005560 0.006144 0.005966 0.006280 0.006487 0.007290 0.007511 0.008080 0.008061 0.009166 0.009135 0.009097 0.009461 0.010040 0.010357 0.010380 0.011175 0.010745 0.011679 0.011515 0.012538 0.012317 0.013229 0.013775 0.013705 0.014191 0.014315 0.014499 0.015160 0.015222 0.015962 0.016315 0.016099 0.016726 0.017523 0.017535 0.018163 0.018162 0.018483 0.019024 0.019416 0.020379 0.021448 0.021313 0.020906 0.021691 0.021336 0.022272 0.022685 0.022462 0.022570 0.023261 0.023333 0.023130 0.023354 0.023062 0.023607 0.024424 0.024462 0.024124 0.025077 0.025557 0.025145 0.026302 0.026472 0.026385 0.026808 0.026957 0.027125 0.027145 0.027297 0.027596 0.028376 0.028991 0.028662 0.031302 0.030575 0.031193 0.031520 0.032093 0.031038 0.034497 0.033719 0.033441 0.033883 0.034163 0.034865
0.000962 0.001195 0.001735 0.002060 0.002217 0.003051 0.003094 0.003634 0.003856 0.004513 0.004637 0.004968 0.005370 0.005546 0.006237 0.006314 0.006910 0.006833 0.007437 0.007885 0.008350 0.008851 0.010742 0.009338 0.009617 0.009722 0.009890 0.010681 0.010630 0.011502 0.010955 0.012071 0.011992 0.013548 0.013275 0.013009 0.014100 0.013734 0.014546 0.014694 0.015240 0.015275 0.015818 0.016521 0.016964 0.016540 0.017329 0.017652 0.017694 0.018360 0.018600 0.019228 0.019382 0.019410 0.020509 0.021055 0.020603 0.021659 0.021437 0.021289 0.021686 0.022829 0.022561 0.022207 0.023378 0.023129 0.023827 0.023817 0.023906 0.023943 0.024800 0.025093 0.025593 0.025589 0.026407 0.026267 0.027121 0.027287 0.027556 0.027839 0.028034 0.028108 0.028321 0.028589 0.029760 0.030214 0.029701 0.030009 0.031319 0.030866 0.032226 0.032392 0.032443 0.032038 0.034485 0.033566 0.035004 0.034861 0.034957 0.036361
*/