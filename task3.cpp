#include <cmath>
#include <iostream>
#include <omp.h>
#include <iomanip>
#include <vector>

using namespace std;

double run(int n, int threads) {
    auto func = [](const double x) {return log(x);};
    double a = 1;
    double b = 100;
    double h = (b-a)/n;

    double time = omp_get_wtime();
    omp_set_num_threads(threads);

    double res = 0;
#pragma omp parallel for default(shared) reduction(+:res)
    for (int i = 0; i < n; ++i) {
        res += h * func(a+i*h);
    }
    return omp_get_wtime() - time;
}

int main() {
    int threads_max = omp_get_max_threads();
    vector times(threads_max, vector(100, 0.));

    int iter_count = 100;
    int n_max = 10'000'000;
    int step = 100'000;


    for (int i = 0; i < iter_count; ++i) {
        cout << "iter " << i +1 << "/" << iter_count << endl;
        for (int n = step; n <= n_max; n += step) {
            cout << n << " ";
        }
        cout << endl;
    }

    cout << endl;
    std::cout << std::fixed;
    std::cout << std::setprecision(8);
    for (const auto& thread : times) {
        for (const auto time : thread) {
            cout << time / iter_count << " ";
        }
        cout << endl;
    }
    return 0;
}

/*
0.00137907 0.00246022 0.00354119 0.00451917 0.00559613 0.00665335 0.00781229 0.00907254 0.00986430 0.01059615 0.01175120 0.01270877 0.01291224 0.01350918 0.01456965 0.01564446 0.01624182 0.01706592 0.01847050 0.01886198 0.01924475 0.02058191 0.02014953 0.02195639 0.02215447 0.02288299 0.02359591 0.02419364 0.02496630 0.02618929 0.02645795 0.02738728 0.02843759 0.02919153 0.02927281 0.03045982 0.03089526 0.03122910 0.03232672 0.03246027 0.03384437 0.03431725 0.03496934 0.03553655 0.03621697 0.03748376 0.03831739 0.03896402 0.03960496 0.04057888 0.04217755 0.04206074 0.04188567 0.04391537 0.04347169 0.04492443 0.04571827 0.04651614 0.04687148 0.04757731 0.04804862 0.04840321 0.04933146 0.04974307 0.04949411 0.04977258 0.04997322 0.05099282 0.05286481 0.05321460 0.05394300 0.05491263 0.05601849 0.05668382 0.05703176 0.05876682 0.05924671 0.05980059 0.05986576 0.06104216 0.06239708 0.06214372 0.06298910 0.06433107 0.06578467 0.06505412 0.06658968 0.06648323 0.06691501 0.06837827 0.06979556 0.06901758 0.07195810 0.07042097 0.07210040 0.07362000 0.07263291 0.07317949 0.07506379 0.07452546
0.00068401 0.00137558 0.00200587 0.00262416 0.00320867 0.00377130 0.00429212 0.00498242 0.00557396 0.00625421 0.00684103 0.00738784 0.00779717 0.00861746 0.00922244 0.01017550 0.01087065 0.01099339 0.01184068 0.01279730 0.01337630 0.01374783 0.01496897 0.01536112 0.01581560 0.01566737 0.01726388 0.01815385 0.01776467 0.01849987 0.01899789 0.01909203 0.02004736 0.02092462 0.02188395 0.02192445 0.02335818 0.02379837 0.02506707 0.02495604 0.02622691 0.02577524 0.02740401 0.02722733 0.02882695 0.02767596 0.02852804 0.02929755 0.03149588 0.02986611 0.03222747 0.03232511 0.03155013 0.03309104 0.03314144 0.03121954 0.03340484 0.03497410 0.03385530 0.03425520 0.03630032 0.03576063 0.03806204 0.03778409 0.03893097 0.04072709 0.04131225 0.04202475 0.04007989 0.04212204 0.04378245 0.04375632 0.04323211 0.04498518 0.04637522 0.04413444 0.04625865 0.04732450 0.04727282 0.04559833 0.04921881 0.04786521 0.04903044 0.04753577 0.04937643 0.04957454 0.05075159 0.05093138 0.05167723 0.05155459 0.05185408 0.05121752 0.05324602 0.05243053 0.05281031 0.05375965 0.05373524 0.05728357 0.05595156 0.05630021
0.00049598 0.00093361 0.00139193 0.00182892 0.00220010 0.00260869 0.00312494 0.00349967 0.00419795 0.00464637 0.00511325 0.00566790 0.00571367 0.00677360 0.00715789 0.00748071 0.00802487 0.00893804 0.00911652 0.01022921 0.01119571 0.01045125 0.01279353 0.01190536 0.01252255 0.01253647 0.01355879 0.01433275 0.01496217 0.01477889 0.01588151 0.01559446 0.01646806 0.01679125 0.01752102 0.01810511 0.01833529 0.01879425 0.02016417 0.02066829 0.02009081 0.02028644 0.02173018 0.02268224 0.02195795 0.02270214 0.02303988 0.02458228 0.02494615 0.02303159 0.02609274 0.02571092 0.02611731 0.02726981 0.02680014 0.02673152 0.02744750 0.02850602 0.02879033 0.02976909 0.03082320 0.03085919 0.03138039 0.03428140 0.03437304 0.03389213 0.03405848 0.03570794 0.03531172 0.03564315 0.03640741 0.03664771 0.03843546 0.03779988 0.03654936 0.03835887 0.03903111 0.04012017 0.04036503 0.04101299 0.03877041 0.04129172 0.04189945 0.04182006 0.04260734 0.04213869 0.04406396 0.04455023 0.04473888 0.04401297 0.04495916 0.04655598 0.04507681 0.04488157 0.04621239 0.04517353 0.04732819 0.04642425 0.04881610 0.04783155
0.00039823 0.00076311 0.00110975 0.00140410 0.00171158 0.00205447 0.00256655 0.00283872 0.00339583 0.00383555 0.00451204 0.00499770 0.00500522 0.00579275 0.00611527 0.00629362 0.00695342 0.00719512 0.00759708 0.00829261 0.00930606 0.00873472 0.01102261 0.01008432 0.01065042 0.01053980 0.01195507 0.01230401 0.01320382 0.01236007 0.01390265 0.01331277 0.01414342 0.01434999 0.01549249 0.01577447 0.01595553 0.01625875 0.01676459 0.01756347 0.01832221 0.01724234 0.01809035 0.01905252 0.01990828 0.01892859 0.01988986 0.02009658 0.02110981 0.02069290 0.02106678 0.02114996 0.02246956 0.02232210 0.02212610 0.02238659 0.02215429 0.02315931 0.02348917 0.02367273 0.02534444 0.02507095 0.02646605 0.02594168 0.02693614 0.02795812 0.02824391 0.02760523 0.02758169 0.02954435 0.02989079 0.02828928 0.02960655 0.02851735 0.02993466 0.03008068 0.03052429 0.02960147 0.03097570 0.03146925 0.03116766 0.03230276 0.03217762 0.03123205 0.03164776 0.03220033 0.03307199 0.03409045 0.03348912 0.03360434 0.03527166 0.03549496 0.03500834 0.03578536 0.03568872 0.03643430 0.03630666 0.03682082 0.03644276 0.03815234
0.00034463 0.00066689 0.00093981 0.00121314 0.00152154 0.00181337 0.00225757 0.00250052 0.00308806 0.00350188 0.00402063 0.00440358 0.00472535 0.00542183 0.00564248 0.00572913 0.00640033 0.00718879 0.00719309 0.00786893 0.00863234 0.00827720 0.00980141 0.00935888 0.00988000 0.01021556 0.01118256 0.01141107 0.01196209 0.01167310 0.01285386 0.01308040 0.01347900 0.01379332 0.01478650 0.01408784 0.01478157 0.01530029 0.01592452 0.01625524 0.01631510 0.01643614 0.01662139 0.01832773 0.01786813 0.01720288 0.01776308 0.01792953 0.01905774 0.01955686 0.01914583 0.01921782 0.01972051 0.02009309 0.02058548 0.02139092 0.02147826 0.02184619 0.02258741 0.02186408 0.02343480 0.02356185 0.02333424 0.02409518 0.02415514 0.02450172 0.02446993 0.02415789 0.02506739 0.02527947 0.02610053 0.02577068 0.02531313 0.02626579 0.02577258 0.02577156 0.02610134 0.02782227 0.02615709 0.02671551 0.02789035 0.02696208 0.02791052 0.02897647 0.02841917 0.02949497 0.02943833 0.02901444 0.03026738 0.02930382 0.03031127 0.03147113 0.03136743 0.03216919 0.03077601 0.03153474 0.03190574 0.03258119 0.03172974 0.03215253
0.00034378 0.00061115 0.00086077 0.00110930 0.00135822 0.00167377 0.00203505 0.00235386 0.00289919 0.00328151 0.00379911 0.00411408 0.00415895 0.00505528 0.00533479 0.00561328 0.00606245 0.00678328 0.00693054 0.00750024 0.00813997 0.00783768 0.00947501 0.00891841 0.00929537 0.00954298 0.01048112 0.01062564 0.01116507 0.01140919 0.01171370 0.01205667 0.01244517 0.01252987 0.01344348 0.01280296 0.01384750 0.01355397 0.01497878 0.01476076 0.01528280 0.01530643 0.01557923 0.01631728 0.01614103 0.01641048 0.01624999 0.01668955 0.01661344 0.01782149 0.01784941 0.01825101 0.01830114 0.01913380 0.01902290 0.01994282 0.01944450 0.01914538 0.02008069 0.01981723 0.02091533 0.01998682 0.02000394 0.02001498 0.02106376 0.02159442 0.02059433 0.02080084 0.02204834 0.02181213 0.02160398 0.02255934 0.02206332 0.02201169 0.02199424 0.02238052 0.02371116 0.02379728 0.02302452 0.02306795 0.02362805 0.02436190 0.02382352 0.02480393 0.02451649 0.02464904 0.02482637 0.02492638 0.02536307 0.02480470 0.02534774 0.02515373 0.02543337 0.02683754 0.02654874 0.02648526 0.02627796 0.02661709 0.02634945 0.02762536
0.00036736 0.00062056 0.00082269 0.00105809 0.00127042 0.00161316 0.00197336 0.00234040 0.00274744 0.00315728 0.00345225 0.00380474 0.00411700 0.00475024 0.00504803 0.00543648 0.00564926 0.00626562 0.00646959 0.00719889 0.00734024 0.00763095 0.00840243 0.00816973 0.00849713 0.00859955 0.00937326 0.00968495 0.00968135 0.01036246 0.01032395 0.01073761 0.01105121 0.01126385 0.01193522 0.01194390 0.01197430 0.01241275 0.01285156 0.01236047 0.01333030 0.01318646 0.01343923 0.01389787 0.01315628 0.01425313 0.01396070 0.01400878 0.01449768 0.01499446 0.01521606 0.01544867 0.01574449 0.01636275 0.01591099 0.01660980 0.01630479 0.01645578 0.01688842 0.01659974 0.01740550 0.01672548 0.01642898 0.01646092 0.01802383 0.01756199 0.01777418 0.01795530 0.01858174 0.01898647 0.01873377 0.01910826 0.01821917 0.01774031 0.01819862 0.01893582 0.01959760 0.02062996 0.01977148 0.01947621 0.02056240 0.02094793 0.02028647 0.02043233 0.02041235 0.02101989 0.02131380 0.02137733 0.02210927 0.02240239 0.02284715 0.02263863 0.02204357 0.02214857 0.02304673 0.02274883 0.02303501 0.02396701 0.02418227 0.02392960
0.00051521 0.00071602 0.00090181 0.00118786 0.00144673 0.00174978 0.00211798 0.00257742 0.00279818 0.00333355 0.00384108 0.00386250 0.00402490 0.00457855 0.00507127 0.00513985 0.00542025 0.00589303 0.00608124 0.00664190 0.00656644 0.00695785 0.00744324 0.00732130 0.00773353 0.00796772 0.00849244 0.00878625 0.00879082 0.00905465 0.00934776 0.00953788 0.00974503 0.01021839 0.01037041 0.01044174 0.01043878 0.01073061 0.01056692 0.01051290 0.01158922 0.01147933 0.01136844 0.01169116 0.01139121 0.01262859 0.01212214 0.01214488 0.01307963 0.01312445 0.01295034 0.01287914 0.01331269 0.01417902 0.01396207 0.01424933 0.01413958 0.01404359 0.01432625 0.01499510 0.01494266 0.01510153 0.01470346 0.01493924 0.01591994 0.01544589 0.01482785 0.01567592 0.01594310 0.01611468 0.01649332 0.01694433 0.01581706 0.01642669 0.01643568 0.01699681 0.01785846 0.01829789 0.01741868 0.01744271 0.01832113 0.01908667 0.01814440 0.01944735 0.01853727 0.01858536 0.01922273 0.01911789 0.01965679 0.02130801 0.02016463 0.02071563 0.02064673 0.02079531 0.02134230 0.02169021 0.02232060 0.02181174 0.02199693 0.02222442
*/